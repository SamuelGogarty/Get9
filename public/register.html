<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register</title>
    <link rel="stylesheet" href="css/lobby_style.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="navbar-container"></div>
    <div class="container">
        <div class="window" name="Register">
            <div class="content">
                <h1 style="color: #E3E41F; text-align: center;">Register</h1>
                <form action="/register" method="POST" class="email-form" style="max-width: 400px; margin: auto;">
                    <input type="text" name="username" placeholder="Username" required class="login-input"><br>
                    <input type="email" name="email" placeholder="Email" required class="login-input"><br>
                    <input type="password" name="password" placeholder="Password" required class="login-input"><br>
                    <button type="submit" class="mapvotebutton" style="margin-top: 15px;">Register</button>
                </form>
                <p style="text-align: center; margin-top: 15px; font-size: 13px;">
                    Already have an account? <a href="/index.html">Login here</a>.
                </p>
            </div>
        </div>
    </div>

    <script>
      (async function() {
        // Load navbar HTML
        try {
          const navResponse = await fetch('/navbar.html?v=' + new Date().getTime());
          document.getElementById('navbar-container').innerHTML = await navResponse.text();
        } catch (error) {
          console.error('Failed to load navbar HTML:', error);
          return;
        }

        // Fetch user info
        let user = null;
        try {
          const userResponse = await fetch('/user/info', { credentials: 'include' });
          if (userResponse.ok) {
            user = await userResponse.json();
          }
        } catch (error) {
          console.error('Failed to fetch user info for navbar:', error);
        }

        // Dispatch a custom event with the user data.
        // The navbar script will listen for this.
        document.dispatchEvent(new CustomEvent('userDataReady', {
          detail: { user }
        }));
      })();
    </script>
</body>
</html>
