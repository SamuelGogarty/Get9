<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Profile</title>
    <link rel="stylesheet" href="styles.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <div class="container">
        <h1>Welcome to Your Profile</h1>
        <p>Welcome, <span id="username">loading...</span>! Your Steam ID is: <span id="steamId">loading...</span></p>
        <p>Your ELO (Skill): <span id="skill">loading...</span></p>
        <img id="profilePicture" src="" alt="Profile Picture" style="display: none; width: 100px; height: 100px;">
        <button id="startMatchmakingBtn">Start Matchmaking</button>
        <div id="lobby" style="display:none;">
            <h2>Lobby</h2>
            <ul id="playerList"></ul>
            <button id="connectServerBtn" style="display:none;">Connect to CS 1.6 Server</button>
            <div id="serverInfo" style="display:none;">
                <p>Server IP: <span id="serverIp">...</span></p>
                <p>Server Port: <span id="serverPort">...</span></p>
            </div>
        </div>
        <a href="/">Go back to main page</a>
    </div>

    <script>
        const socket = io();

        // Fetch user info and ELO (skill)
        function fetchUserInfo() {
            fetch('/user/info')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('username').textContent = data.username || 'Unknown user';
                    document.getElementById('steamId').textContent = data.steamId || 'No Steam ID';

                    // Display the profile picture if available
                    const profilePicture = document.getElementById('profilePicture');
                    if (data.profilePictureUrl) {
                        profilePicture.src = data.profilePictureUrl;
                        profilePicture.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error fetching user info:', error);
                    document.getElementById('username').textContent = 'Error loading username';
                    document.getElementById('steamId').textContent = 'Error loading Steam ID';
                });

            // Fetch player's skill (ELO)
            fetch('/user/skill')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('skill').textContent = data.skill || 'No skill data';
                })
                .catch(error => {
                    console.error('Error fetching player skill:', error);
                    document.getElementById('skill').textContent = 'Error loading skill';
                });
        }

        document.getElementById('startMatchmakingBtn').addEventListener('click', () => {
            const username = document.getElementById('username').textContent;
            const steamId = document.getElementById('steamId').textContent;
            const profilePictureUrl = document.getElementById('profilePicture').src;
            socket.emit('startMatchmaking', { username, steamId, photos: [{ value: profilePictureUrl }] });
        });

        // Fetch user info and skill on page load
        fetchUserInfo();
    </script>
</body>
</html>
