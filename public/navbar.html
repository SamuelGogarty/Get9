<style>
  body {
    /* Add padding to the top of the body to prevent content from being hidden by the fixed navbar */
    padding-top: 150px; /* Banner (80px) + Nav (~50px) + padding/gap */
  }

  .header-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background-color: #000; /* Black background */
    z-index: 1000;
    display: flex;
    flex-direction: column;
    align-items: center;
    border-bottom: 1px solid #222; /* Slightly lighter border on black */
    box-shadow: 0 2px 4px rgba(0,0,0,0.4);
    padding: 5px 0; /* 5px top/bottom padding */
    gap: 5px; /* Space between banner and nav */
  }

  .banner-image {
    max-height: 80px; /* Scale down the banner */
    width: auto;
  }

  nav {
    /* This ensures the nav itself is centered within the header-container */
    display: inline-block;
  }
</style>
<div class="header-container">
  <a href="/"><img src="/img/retromatch_banner.jpg" alt="RetroMatch Banner" class="banner-image"></a>
  <nav>
    <ul>
      <li><a href="/profile.html" class="nav-item" id="nav-home">Home</a></li>
      <li><a href="/lobby.html" class="nav-item">Lobby</a></li>
      <li><a href="/player.html" class="nav-item">My Stats</a></li>
      <li><a href="https://discord.gg/8m4xG8sjXm" class="nav-item" target="_blank">Discord</a></li>
      <li><a href="/profile-settings.html" class="nav-item">Profile Settings</a></li>
      <li><a href="/about.html" class="nav-item">About</a></li>
      <li><a href="/contact.html" class="nav-item">Contact</a></li>
      <li><a href="/store.html" class="nav-item">Store</a></li>
      <li><a href="/forums.html" class="nav-item">Forums</a></li>
      <li class="right-nav">
        <div class="nav-player-name">
          <img id="navbarProfile" src="/img/fallback-pfp.png" alt="Avatar">
          <span id="navbarUsername">Player Name</span>
          <span id="navbarElo" class="elo-display">ELO: 0</span>
        </div>
      </li>
    </ul>
  </nav>
</div>

<script>
  // This function populates the navbar with the provided user information.
  async function populateNavbar(user) {
    const rightNavLi = document.querySelector('.right-nav');
    const navHome = document.getElementById('nav-home');
    const navLobby = document.querySelector('a[href="/lobby.html"]');
    const navMyStats = document.querySelector('a[href="/player.html"]');
    const navProfileSettings = document.querySelector('a[href="/profile-settings.html"]');

    // Safety check for navbar elements
    if (!rightNavLi || !navHome || !navLobby || !navMyStats || !navProfileSettings) {
      console.error("One or more navbar elements could not be found.");
      return;
    }

    if (!user) {
      // User is not logged in, show the login button and hide protected links.
      navHome.href = '/';
      navLobby.parentElement.style.display = 'none';
      navMyStats.parentElement.style.display = 'none';
      navProfileSettings.parentElement.style.display = 'none';

      rightNavLi.innerHTML = `
        <a href="/auth/steam" style="text-decoration: none;">
          <button class="greensteam-button" style="padding: 8px 16px; vertical-align: middle;">
            Sign in with Steam
          </button>
        </a>
      `;
      return;
    }

    // User is logged in. Populate the navbar with their details.
    document.getElementById('navbarUsername').textContent = user.username;
    
    const profileImg = document.getElementById('navbarProfile');
    profileImg.src = user.profilePictureUrl || '/img/fallback-pfp.png';
    profileImg.onerror = function() {
      this.src = '/img/fallback-pfp.png';
    };
    
    navHome.href = '/profile.html';

    // Fetch the user's ELO rating.
    try {
      const eloRes = await fetch('/user/skill', { credentials: 'include' });
      if (eloRes.ok) {
        const eloData = await eloRes.json();
        document.getElementById('navbarElo').textContent = `ELO: ${eloData.skill || 0}`;
      } else {
        document.getElementById('navbarElo').textContent = 'ELO: 0';
      }
    } catch (error) {
      console.error('Failed to fetch ELO for navbar:', error);
      document.getElementById('navbarElo').textContent = 'ELO: 0';
    }
  }

  // Listen for the custom event dispatched by the parent page.
  document.addEventListener('userDataReady', (event) => {
    const user = event.detail.user;
    populateNavbar(user);
  });
</script>
