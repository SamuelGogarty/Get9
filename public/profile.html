<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link rel="stylesheet" href="styles.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <div class="container">
        <h1>Welcome to Your Profile</h1>
        <p>Welcome, <span id="username">loading...</span>! Your Steam ID is: <span id="steamId">loading...</span></p>
        <button id="startMatchmakingBtn">Start Matchmaking</button>
        <div id="lobby" style="display:none;">
            <h2>Lobby</h2>
            <ul id="playerList"></ul>
            <button id="connectServerBtn" style="display:none;">Connect to CS 1.6 Server</button>
            <!-- Server IP display -->
            <div id="serverInfo" style="display:none;">
                <p>Server IP: <span id="serverIp">10.0.0.233</span></p>
            </div>
        </div>
        <a href="/">Go back to main page</a>
    </div>

    <script>
        const socket = io();

        fetch('/user/info').then(response => response.json()).then(data => {
            document.getElementById('username').textContent = data.displayName;
            document.getElementById('steamId').textContent = data.id;
        }).catch(error => console.error('Error fetching user info:', error));

        document.getElementById('startMatchmakingBtn').addEventListener('click', () => {
            const playerData = {
                username: document.getElementById('username').textContent,
                steamId: document.getElementById('steamId').textContent
            };
            socket.emit('startMatchmaking', playerData);
        });

        socket.on('lobbyCreated', (lobbyPlayers) => {
            document.getElementById('lobby').style.display = 'block';
            const playerList = document.getElementById('playerList');
            playerList.innerHTML = '';

            lobbyPlayers.forEach(player => {
                const playerItem = document.createElement('li');
                playerItem.textContent = `${player.username} (Steam ID: ${player.steamId})`;
                playerList.appendChild(playerItem);
            });

            // Show the "Connect to Server" button and server IP for all users
            document.getElementById('connectServerBtn').style.display = 'block';
            document.getElementById('serverInfo').style.display = 'block';
        });

        document.getElementById('connectServerBtn').addEventListener('click', function() {
            const serverIp = document.getElementById('serverIp').textContent;
            window.location.href = `steam://connect/${serverIp}`;
        });
    </script>
</body>
</html>
